sap.ui.define(["./BaseController","sap/ui/model/odata/v2/ODataModel","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment"],function(e,s,n,i,o,r,t){"use strict";return e.extend("com.app.libraryapplication.controller.Home",{onInit:function(){var e=new s("/v2/odata/v4/catalog/");this.getView().setModel(e);const n=new i({username:"",password:"",email:"",phoneNumber:"",usertype:"user"});this.getView().setModel(n,"localModel")},onSignUpButton:async function(){if(!this.oSignUpDialog){this.oSignUpDialog=await this.loadFragment("SignUp")}this.oSignUpDialog.open()},onCloseSignUpDialog:function(){if(this.oSignUpDialog.isOpen()){this.oSignUpDialog.close()}},onLoginperss:async function(){if(!this.oLoginDialog){this.oLoginDialog=await this.loadFragment("Login")}this.oLoginDialog.open()},onCloseLoginDialog:function(){if(this.oLoginDialog.isOpen()){this.oLoginDialog.close()}},signupBtnClick:async function(){const e=this.getView().getModel("localModel").getProperty("/"),s=this.getView().getModel("ModelV2");if(e.username&&e.password){}else{sap.m.MessageBox.error("Please enter valid userName and Password");return}var i=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;var o=/^(?:(?:\+|0{0,2})91(\s*[\-]\s*)?|[0]?)?[789]\d{9}$/;if(!(i.test(e.email)&&o.test(e.phoneNumber))){n.show("please enter valid email and phoneNumber");return}try{var r=await this.checkUserName(s,e.username,e.password);var t=await this.checkEmail(s,e.email);var a=await this.checkPhone(s,e.phoneNumber);if(r){n.show("User already exsist");return}if(t){n.show("Email already exsist for another user please enter vaild email ");return}if(a){n.show("PhoneNumber already exsist for another user please enter valid Phonenumber");return}await this.createData(s,e,"/Users");n.show("Registration Successfull");this.oSignUpDialog.close()}catch(e){this.oSignUpDialog.close();sap.m.MessageBox.error("Some technical Issue")}},checkUserName:async function(e,s,n){return new Promise((n,i)=>{e.read("/Users",{filters:[new o("username",r.EQ,s)],success:function(e){n(e.results.length>0)},error:function(){i("An error occurred while checking username existence.")}})})},checkEmail:async function(e,s){return new Promise((n,i)=>{e.read("/Users",{filters:[new o("email",r.EQ,s)],success:function(e){n(e.results.length>0)},error:function(){i("An error occurred while checking username existence.")}})})},checkPhone:async function(e,s){return new Promise((n,i)=>{e.read("/Users",{filters:[new o("phoneNumber",r.EQ,s)],success:function(e){n(e.results.length>0)},error:function(){i("An error occurred while checking username existence.")}})})},onPress:function(){var e=this.getView();var s=e.byId("_IDLoginGenInput").getValue();var i=e.byId("_IDGenLoginInput1").getValue();if(!s||!i){n.show("please enter username and password.");return}var t=this.getView().getModel();t.read("/Users",{filters:[new o("username",r.EQ,s),new o("password",r.EQ,i)],success:function(e){if(e.results.length>0){var s=e.results[0].ID;var i=e.results[0].usertype;n.show("Login Successful");if(i==="Admin"){var o=this.getOwnerComponent().getRouter();o.navTo("RouteDetails",{userId:s});var r=this.getView();r.byId("_IDLoginGenInput").setValue("");r.byId("_IDGenLoginInput1").setValue("")}else{var o=this.getOwnerComponent().getRouter();o.navTo("RouteUser",{userId:s});var r=this.getView();r.byId("_IDLoginGenInput").setValue("");r.byId("_IDGenLoginInput1").setValue("")}}else{n.show("Invalid username or password.")}}.bind(this),error:function(){n.show("An error occured during login.")}})}})});